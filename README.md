# dy_lottery_helper
## 项目交流群
微信群无了，换QQ群

群号:927058243

## 程序特色:
1.采用多种方式查找合适的直播间，不依赖于解密算法避免了需要频繁更新算法的问题

2.遵循’少即是多’原则，不频繁切换直播间，严格筛选更容易中的福袋，虽然无法避免被风控，但是尽可能缩短了被风控的时间

3.会参与粉丝团福袋，利用付费行为提高了每日可中钻石数量的上限，顺便也能提升你的消费等级

4.程序带有被风控检测，如果检测到可能处于被风控状态，会更加严格地筛选福袋以减少福袋的参与，避免更严重的黑号情况，同时尽可能减少了因参与粉丝团福袋导致的钻石损失的情况
## 程序效果(双账号):
<img width="1304" height="940" alt="0_today(2025-10-18)" src="https://github.com/user-attachments/assets/9013a576-796b-4fc6-90c8-b0a33faafe78" />

## 2025/10/19
## 版本3.3.0
1.新增了lottery_info记录的内容，现在每条记录会标注上’account:账号0’或者’account:账号1’，这取决于你是否切换了账号

2.修改了功能’符合条件时自动暂停程序’和VIP功能’符合条件时切换账号’的部分条件判断，你可以在’账号说明.docx’文件中查看修改字段的含义

3.修复了有时候仍会将不想要的某种类型的福袋加入到等待池中的bug

4.修复了实物福袋被误跳过(没有被正确参与)的bug

5.修复了符合切换账号的条件时账号没有被正确切换的bug

6.略微调整了pushplus消息推送的通知内容，抽中的福袋将会被标注上福袋类型

## 2025/10/18
## 版本3.2.2
1.增加了消息推送功能，你可以在程序运行后自动创建的pushplus.json文件里填写pushplus的token，这样中奖时就会自动推送中奖通知到你的微信了

**你可以点击消息通知的’查看详情’查看今日lottery_info的关键数据**

**pushplus官网:**

**https://www.pushplus.plus/**

2.修复了开启’自动抢红包’功能后，修改’启动时打开要切换的账号所在的浏览器’字段无效的bug

3.修复了免费人气红包没有被参与的bug

4.修改了一些逻辑不合理的地方

## 2025/10/17
## 版本3.2.1
1.优化了直播间出现多红包情况的处理，减少了没有正确参与红包的情况

2.优化了参与人气红包的逻辑，观察到在某直播间的某小时参与过人气红包，则后续在该直播间的该小时内参与的所有人气红包都不需要再次消耗1钻

3.修复了在某些情况下无法关闭多余标签页的bug

4.修复了一些会导致程序无法正常运行的bug

5.修复了偶现的抽中了钻石/礼物/人气红包但没有被记录下来的bug

6.修改了一些逻辑不合理的地方

## 2025/10/16
## 版本3.2.0
1.开放了免费VIP时段，如果你在20:00-22:00之间登录，可以在该时段免费使用VIP功能，不在该时间段免费VIP会自动失效

2.增强了VIP功能’筛选福袋类型’和’设置福袋筛选概率’的能力，现在可以设置是否抢实物福袋以及设置实物福袋的相关筛选概率了

**注意:实物福袋的参与优先度是最高的**

**该功能为测试功能，默认不开启也不建议开启，开启后可能有很多bug，现有算法也并不能有效地找寻有发放实物福袋的直播间**

3.修复了因为检测到Google Chrome运行异常->重启浏览器后会开启两次控制浏览器线程的bug

4.修改了一些逻辑不合理的地方，减少了程序运行异常的可能性

## 2025/10/14
## 版本3.1.0
1.增加了lottery_info记录的内容，将会统计’今日中过的礼物红包的总收益’，**注意:’今日中过的礼物红包的总收益’不会包含在’今日总收益’内，’今日中过的礼物红包的总收益’不会包含所有未知礼物价值(gift_value值为unknown)的收益**

2.增强了VIP功能’自动抢红包’的能力，现在可以设置是否抢人气红包(该红包需要消耗1钻来参与，抽中的奖励是一些免费礼物)，以及抢人气红包的次数上限

**如果抽中了人气红包，也会被记录下来，但其收益只会统计至’今日中过的礼物红包的总收益’中**

3.优化了user.json的迁移逻辑，现在可以将原本user.json里的相关数据完全迁移到新的user.json中了

4.修复了偶现的Google Chrome浏览器不执行’自动抢福袋’以及’自动抢红包’任务的bug，如果Google Chrome加载网页的时间过久(不知道什么原因，正常情况下await page.goto方法在网页加载时间过长时会自动停止加载网页，但Google Chrome浏览器还是会经常一直在加载网页导致程序运行异常)，会自动重启Google Chrome浏览器

5.现在不会在参与福袋/红包的时候重启Google Chrome浏览器了

## 2025/10/13
## 版本3.0.2
1.增加了lottery_info记录的内容，将会自动记录中过的礼物红包

**礼物红包说明:抽中的免费礼物请在1天之内使用，不然会过期！使用这些免费礼物不会增加消费等级的进度，但主播收到这些免费礼物是有收益的。**

2.有时候打开程序时，左边浏览器会异常打开多个标签页，导致程序无法正常运行。采取了一些措施使程序在这种情况下能够正常运行，不过还是建议:如果出现这种情况，请清除左边浏览器的缓存！

3.优化了VIP功能’自动抢红包’的部分逻辑

**4.修复了版本3.0.0和3.0.1在不开启’自动抢红包’功能时无法正常执行’自动抢福袋’任务的bug**

## 2025/10/13
## 版本3.0.1(有严重异常的版本！)
1.注意到在程序运行很久后，playwright加载新网页会加载很长时间，故每隔2小时会重启Google Chrome浏览器

2.优化了VIP功能’自动抢红包’的部分逻辑

3.修复了切换账号/重启浏览器后偶现的右边浏览器不再执行任务的bug

## 2025/10/12
## 版本3.0.0(有严重异常的版本！)
1.增加了VIP功能’自动抢红包’，启用该功能时，如果直播间有可参与的红包，将会自动参与红包，目前只会自动抢礼物红包和钻石红包，特殊类型的红包(比如需要送出人气票才可参与的红包)会被忽略。与此同时，直播间搜索算法会同时搜寻有发放红包的直播间

**启用该功能之前，请先下载/更新Google Chrome浏览器，因为启用该功能后，浏览器将由playwright操控(提升了反反爬能力，而且不会拦截不需要拦截的iframe)而非原先的selenium**

**由于playwright限制，打开的Google Chrome浏览器无法自动调整大小及位置，也无法被隐藏，请手动调整Google Chrome浏览器大小及其位置，见谅**

2.user.json文件将会自动更新到最新版的格式，原有的数据可能无法全部迁移，
可以在程序运行后自行查看自动更新后的user.json文件

3.增加了lottery_info记录的内容，将会自动记录中过的钻石红包

## 2025/10/06
## 版本2.5.5
1.增加了提醒:当0<今日中奖率<0.03时，程序运行时会用红色字体提醒你不建议继续进行抢福袋任务

2.增加了通用功能’符合条件时暂停程序’，该功能会在符合某些条件时自动暂停程序

**本次user.json格式发生变更，请删除原有的user.json文件！**

## 2025/10/05
## 版本2.5.4
1.增强了VIP功能’设置福袋筛选概率’的筛选能力，你可以在’账号说明.docx’文件中了解新增字段的用途

**本次user.json格式发生变更，请删除原有的user.json文件！**

## 2025/10/05
## 版本2.5.3
1.增加了功能’检查程序版本’，程序将会在最开始尝试获取最新程序的版本号，如果当前程序的版本号与最新程序的版本号不一致，会提醒你前往Github下载最新版本的程序

2.添加逻辑:如果最符合条件的直播间的福袋剩余时间<30s，右边浏览器将不再跳转到该直播间

3.修复了右边浏览器仍会频繁跳转到保存数据异常的直播间的bug

## 2025/10/03
## 版本2.5.2
1.优化了筛选福袋的逻辑:福袋的初次筛选概率将会略高于给定的福袋筛选概率，初次筛选概率=给定筛选概率+math.log(福袋的剩余开奖时间, 3)/100

2.修改了一些逻辑不大合理的地方

## 2025/10/03
## 版本2.5.1
1.优化了筛选福袋的逻辑

2.修改逻辑:福袋预测中奖概率最大的直播间的福袋剩余时间<3分钟时就进入该直播间 → 福袋预测中奖概率最大的直播间的福袋剩余时间<5分钟时就进入该直播间

3.修复了版本2.5.0会经常出现参与福袋异常的bug

## 2025/10/02
## 版本2.5.0
1.优化了右边浏览器跳转到新的直播间的逻辑，降低了页面跳转的频率

2.优化了预测福袋最终概率的算法

3.新增逻辑:风控状态下会调整普通福袋的筛选概率至原来的0.8倍，基于猜测:连续且频繁参与粉丝团福袋会导致粉丝团福袋的中奖权重迅速降低，但是付费行为会小幅提高普通福袋的中奖权重

4.新增逻辑:每次抽奖结束后会随机在直播间内停留随机秒数，本次没有中奖将随机停留[30, 60]秒，本次中奖了将随机停留[120, 180]秒

5.修复了偶现的右边浏览器停止工作且不会自动刷新的bug

6.有时候会跳转到保存数据异常的直播间，目前还不清楚为什么会产生这个异常，只能加了个多次进入异常判断以清除这些保存数据异常的直播间，避免频繁进行异常的页面跳转

## 2025/09/30
## 版本2.4.5
1.略微提高了通过类别查询直播间的成功率，略微提高了VIP用户调用该方法的频率

2.修复了粉丝团福袋的筛选概率没有被正确动态调整的bug

## 2025/09/29
## 版本2.4.4
1.添加了键盘监听事件:按下’2’键即可暂停/恢复程序运行(注意:暂停程序不会阻止当前正在参与的福袋的操作！)

2.修复了浏览器在具有多屏幕的情况下不会被彻底隐藏的bug

## 2025/09/29
## 版本2.4.3
1.修复了有时候符合条件的直播间列表会出现两个room_id相同的直播间导致右边的浏览器不停地在同一直播间刷新的bug

2.修复了偶现的没有跳转到最符合条件的直播间的bug

3.修复了fake_useragent库在打包后会导致通过类别查找直播间的算法失效的bug

## 2025/09/29
## 版本2.4.2
1.略微调整了通过类别查找直播间的查找范围

2.修复了由于日期变更导致最新的lottery_info文件更新失败的bug

## 2025/09/28
## 版本2.4.1
1.增加了VIP功能’符合条件时切换账号’，该功能会在符合某些条件时来回切换你的抖音账号，现版本VIP用户拥有的功能:(1)设置福袋筛选概率;(2)筛选福袋类型;(3)自定义被风控规则;(4)符合条件时切换账号

2.优化了查看所停留直播间福袋的逻辑

## 2025/09/28
## 版本2.4.0
1.增加了lottery_info记录的内容

2.优化了记录直播间的逻辑

3.优化了浏览器操作逻辑

4.修复了查找直播间的算法会因接口返回数据异常而停止查找的bug

5.修复了因更新room_id而导致异常关闭左边浏览器第一个标签页的bug

## 2025/09/26
## 版本2.3.0
1.增加了lottery_info记录的内容

2.优化了查找直播间的算法

3.修复了一部分符合条件的福袋没有被正确记录以及参与的bug

4.修复了record3.json文件中一些直播间的room_id没有被正确更新的bug

## 2025/09/24
## 版本2.2.0
1.优化了查找直播间的算法

2.修复了左边浏览器窗口无法找到福袋的bug

## 2025/09/22
## 版本2.1.2
1.**优化了被风控判断逻辑**，变更为’当本次钻石收益/今日钻石收益<=-5时或本次抽中福袋的频率<0.1时会触发该检测，同时提高粉丝团福袋的筛选概率’

2.修复了VIP功能无法正常使用的bug，并添加了VIP功能’自定义被风控判断规则’，现版本VIP用户拥有的功能:(1)设置福袋筛选概率;(2)筛选福袋类型;(3)自定义被风控规则

## 2025/09/21
## 版本2.1.1
解决了selenium使用switch_to.window方法时会抢夺窗口焦点的问题，但仍保留了键盘监听事件

如果浏览器仍然会抢夺窗口焦点，请尝试重启程序

## 2025/09/19
## 版本2.1.0
1.修复了一些bug

2.添加了一些VIP功能，在’账号说明’中有提到，**VIP用户搜索到的直播间会更加优质**

3.添加了**键盘事件监听**，解决了浏览器窗口会被强制放在最前面造成电脑使用不便的问题。你可以按下’1’键来隐藏浏览器，但不要频繁按下’1’键，有时候监听会失灵。你可以按下’f2’键取消键盘事件监听

**注意:被隐藏的浏览器仍然会占用窗口焦点，这意味着如果你需要频繁地使用键盘，十分不建议运行该程序！！！(鼠标操作影响不大)**

**还是建议你在服务器上或者虚拟机上运行该程序！**

## 2025/09/17
## 版本2.0.0
对未发布的初始版本1.0.0进行了重构

## 程序功能:

1.尽可能**模拟了真实用户抢福袋**，并运用了一定程度的**反反爬措施**，以尽可能减少被风控的可能性和风控时间

2.会**自动抢指定类型(发送评论/粉丝团福袋)的福袋**，暂不支持抢其它类型的福袋

福袋筛选概率(大于指定数值时会抢):

发送评论 -> 0.1

粉丝团 -> 0.2 + math.log(未中福袋的数量, 2)/100 + 中福袋的数量/100 

(被风控状态下->0.3 + math.log(未中福袋的数量, 2)/100 + 中福袋的数量/100)

**暂不支持只抢某种类型的福袋以及修改某种类型的福袋的筛选概率**

3.一些**福袋抽奖记录**(加入粉丝团/抽中了福袋)会保存至_internal/lottery/xxx.json下，0_today.json记录了今天的福袋抽奖记录

4.添加了'**被风控检测**'，当本次钻石收益/今日钻石收益<-10时会触发该检测，同时提高粉丝团福袋的筛选概率

## 目前版本无法解决的问题:
> [!WARNING]
> **程序运行时会频繁将浏览器窗口放在最前面。**

> [!TIP]
> **可能的解决方法:**\
> \
> 1.部署到服务器上\
> \
> 2.部署到虚拟机上

**如果不采用以上方法，请在不使用电脑的情况下运行该程序，不然会影响电脑使用体验！**
